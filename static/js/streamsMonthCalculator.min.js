let streamingPayRatesData;const calculationTypeSelect=document.getElementById("calculation-type"),calculatorElement=document.getElementById("calculator"),decimalPrecision=2,earningsAmountSpan=document.getElementById("earnings-amount"),earningsResultsDiv=document.getElementById("earnings-results"),hiddenClass="hidden",jsonPath="/royalties-calculator/data/streaming_pay_rate.json",questionDiv=document.getElementById("question"),resultsDiv=document.getElementById("results"),targetAmountElement=document.getElementById("target-amount");async function fetchStreamingPayRates(){try{var e=await fetch(jsonPath);if(!e.ok)throw new Error("Network response was not ok");createElementForStore(streamingPayRatesData=await e.json()),initializeCalculator(),toggleCalculatorMode()}catch(e){console.error("There was a problem with the fetch operation:",e)}}function createElementForStore(e){resultsDiv.innerHTML="",resultsDiv.className="results-grid",e.forEach((e=>{var t=normalizeStoreName(e.Store),a="Meta"===e.Store?"Instagram & Facebook":e.Store;resultsDiv.insertAdjacentHTML("beforeend",`<div class="store-box">\n        <img src="/img/streaming_logos/${t}.png" alt="" class="store-logo${"tidal"===e.Store.toLowerCase()?" invertible-image":""}">\n        <div class="streams-needed">0</div>\n        <input class="streams-for-store ${hiddenClass}" id="${t}-streams-needed" type="number" inputmode="numeric" value="0" aria-label="Streams from ${a}">\n        <div class="store-name" aria-hidden="true">${a}</div>\n       </div>`);const n=(e=resultsDiv.lastElementChild).querySelector(`#${t}-streams-needed`);e.addEventListener("click",(()=>{n.focus(),n.select()})),applyValidationToInput(n),n.addEventListener("input",(()=>{applyValidationToInput(n)}))}))}function applyValidationToInput(e){var t=isValidNumber(e.value);e.style.borderBottom=t?"2px solid var(--primary-color)":"2px solid red",e.setAttribute("aria-invalid",!t)}function isValidNumber(e){return/^-?\d*\.?\d+(e\d+)?$/.test(e)&&0<=parseFloat(e)}function initializeCalculator(){var e=getUserInputs();e&&updateResults(streamingPayRatesData,e)}function getUserInputs(){var e=calculationTypeSelect.value,t=parseFloat(targetAmountElement.value);return isNaN(t)||t<0?null:{calculationType:e,targetAmount:t}}function updateResults(e,{calculationType:t,targetAmount:a}){e.forEach((e=>{var n=normalizeStoreName(e.Store);e=Math.ceil(a/e[t]).toLocaleString(),document.querySelector(`#${n}-streams-needed`).previousElementSibling.textContent=e}))}function normalizeStoreName(e){return e.toLowerCase().replace(/\s+/g,"_")}function toggleCalculatorMode(){const e="CalculateEarnings"===document.querySelector('input[name="mode"]:checked').value;questionDiv.classList.toggle(hiddenClass,e),earningsResultsDiv.classList.toggle(hiddenClass,!e),document.querySelectorAll(".streams-needed").forEach((t=>t.classList.toggle(hiddenClass,e))),document.querySelectorAll(".streams-for-store").forEach((t=>{t.classList.toggle(hiddenClass,!e),(t=t.closest(".store-box"))&&(e?t.classList.add("clickable"):t.classList.remove("clickable"))}))}function updateEarningsResults(){var e;"CalculateEarnings"===document.querySelector('input[name="mode"]:checked').value&&(e=calculateEarnings().toFixed(2),e=parseFloat(e).toLocaleString(),earningsAmountSpan.textContent="$"+e)}function calculateEarnings(){const e=calculationTypeSelect.value;return Array.from(document.querySelectorAll(".streams-for-store")).reduce(((t,a)=>{var n=parseFloat(a.value);if(!isNaN(n)&&0<n){const r=a.id.split("-")[0];return t+n*streamingPayRatesData.find((e=>normalizeStoreName(e.Store)===r))[e]}return t}),0)}function reorderServices(){const e=calculationTypeSelect.value;var t=[...streamingPayRatesData].sort(((t,a)=>a[e]-t[e]));const a=document.createDocumentFragment();t.forEach((e=>{e=normalizeStoreName(e.Store),(e=document.getElementById(e+"-streams-needed").closest(".store-box"))&&a.appendChild(e)})),resultsDiv.appendChild(a)}targetAmountElement.addEventListener("input",(()=>{applyValidationToInput(targetAmountElement)})),targetAmountElement.addEventListener("click",(()=>{targetAmountElement.focus(),targetAmountElement.select()})),calculatorElement.addEventListener("input",(()=>{streamingPayRatesData&&(initializeCalculator(),updateEarningsResults())})),document.querySelectorAll('input[name="mode"]').forEach((e=>{e.addEventListener("change",(()=>{toggleCalculatorMode(),updateEarningsResults()}))})),calculationTypeSelect.addEventListener("change",(()=>{reorderServices()})),fetchStreamingPayRates();
